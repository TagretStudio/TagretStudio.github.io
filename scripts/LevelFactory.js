define(["Images","LummingFactory","VisibleLummingFactory","ColorEnum","MusicFactory","PlatformFactory","DoorsFactory","MenuFactoryTest","VisionEnum","Transition","FilterFactory","RadioLummingFactory","MicroLummingFactory","ItemsLevel","MiroirFactory","LevelStructure","XLummingFactory","IceFactory","WaterFactory","SteamFactory","PorteWithAuraFactory"],function(e,t,i,a,n,o,l,r,c,u,d,s,g,m,p,h,y,f,v,b,F){function L(e,t){t.interact(e)}function S(e,t){if(10==e.color&&0!=e.body.velocity.x&&(2==t.defaultVision||1==t.defaultVision)){var i=e.body.velocity.x;e.body.velocity.x<0,t.body.velocity.x=0,t.body.velocity.y=-100,t.body.gravity.y=-100,t.animations.play("kill"),t.color=null,e.body.velocity.x=0,E.time.events.add(.75*Phaser.Timer.SECOND,function(){t.kill(),e.body.velocity.x=i},this)}}function w(e,t){var i=(e.left+e.right)/2,a=t.left,n=t.right;if(i>a&&n>i){var o=e.collideWithDoor(t);1==o&&(T+=1,this.time.events.add(1e3,function(){text.setText(T+"/"+P)},this))}}function M(e,t){9==e.color?t.isPb&&E.physics.arcade.collide(e,t,M,null,E):E.physics.arcade.collide(e,t,M,null,E)}function C(){E.add.sprite(0,0,"transitionBackground"),E.add.sprite(E.world.centerX-216,E.world.centerY-35,"logo");null!=A&&(A.getMusic().fadeOut(700),A.getMusic().onFadeComplete.dispatch(),A.getMusic().onFadeComplete.addOnce(function(){A=null,N=c.getVisionEnum().VISIBLE,E.state.start("LevelFactory")},E))}function x(){E.add.sprite(0,0,"transitionBackground"),E.add.sprite(E.world.centerX-216,E.world.centerY-35,"logo");O=1,null!=A&&(A.getMusic().fadeOut(700),A.getMusic().onFadeComplete.dispatch(),A.getMusic().onFadeComplete.addOnce(function(){A=null,E.state.start("MainMenu")},E))}function D(){E.paused=!0,z=this.add.sprite(0,0,"aideScreen"),z.scale.set(E.world.width/786,E.world.height/588),q=!0}var E=null,O=null,P=0,T=0,_=null,k=null,I=null,V=null,B=null,A=null,R=null,N=null,W=null,X=null,q=!1,Y=!0,z=null,j={preload:function(){A=Y?n.create("level1","media/audio/Level 1.ogg"):n.create("level2","media/audio/level.ogg"),E.load.image("buttonDiamond","media/img/menuButton.png"),E.load.image("buttonRefresh","media/img/refresh.png"),E.load.image("cliquez","media/img/cliquerPourCommencer.png"),E.load.image("aide","media/img/aideColore.png"),E.load.image("aideScreen","media/img/ecranAide.png"),r.init(E),o.init(E),i.init(E),h.init(E),y.init(E),g.init(E),f.init(E),v.init(E),b.init(E),F.init(E)},create:function(){if(_alreadyChangeLevel=!1,T=0,A.play(),e.boot().create(),E.physics.startSystem(Phaser.Physics.ARCADE),N=c.getVisionEnum().VISIBLE,c.setVisionCurrent(N),X=E.add.sprite(0,0,"preloaderBackground"),X.tint=0,X.alpha=.5,this.levelStruct=h.create(O),_=this.levelStruct.getPlatforms(),_groupDoors=this.levelStruct.getDoors(),k=this.levelStruct.getLummings(),I=this.levelStruct.getElements(),V=this.levelStruct.getPorteRadioAura(),B=E.add.group(),B.enableBody=!0,V.forEach(function(e){B.add(e.getDoor())}),P=this.levelStruct.getNbLummingsWin(),W=this.levelStruct.getTabAvailableObjects(),0==P)O=1,E.state.start("MainMenu");else{text=E.add.text(E.world.width-50,0,T+"/"+P,{align:"center",fill:"#ffffff",stroke:"#000000",strokeThickness:2}),text.anchor.set(1,0),button_menu=E.add.button(10,0,"buttonDiamond",x,E),button_restart=E.add.button(E.world.width-150,0,"buttonRefresh",C,E),button_help=E.add.button(90,0,"aide",D,E),button_help.scale.set(64/148,32/74),button_menu.scale.set(64/148,32/74),R=r.create(W),m.reinit(E),m.setgroup(k);var t=this.add.sprite(E.world.width/2,2*E.world.height/3,"cliquez");t.anchor.set(.5,.5),t.scale.set(.7,.7),E.input.onDown.add(function(){E.paused&&(E.paused=!1,t.destroy())},E),E.paused=!0}},update:function(){R.update(),E.physics.arcade.overlap(k,_,M,null,E),E.physics.arcade.overlap(k,_groupDoors,w,null,E),E.physics.arcade.overlap(k,m.getGroupItem(),m.collideItem,null,E),E.physics.arcade.overlap(k,I,L,null,E),E.physics.arcade.overlap(k,k,S,null,E),E.physics.arcade.overlap(k,V,function(e,t){t.setOverlap(e,E.time.now+100)}),E.physics.arcade.collide(k,B),k.forEach(function(e){e.update(N)}),_groupDoors.forEach(function(e){e.update()}),X.alphaTarget=.5-.5*T/P,X.alpha+=(X.alphaTarget-X.alpha)/8,1==q&&(q=!1,z.kill(),E.input.onDown.add(function(){E.paused=!1},E)),P==T?(_alreadyChangeLevel||E.time.events.add(1.8*Phaser.Timer.SECOND,function(){0==P?u.nextState("MainMenu",A):(O++,Y=!Y,u.nextState("LevelFactory",A,O))}),_alreadyChangeLevel=!0):0==k.countLiving()&&(E.add.sprite(E.world.centerX-170,E.world.centerY-25,"gameOver"),A.getMusic().fadeOut(1500),A.getMusic().onFadeComplete.addOnce(function(){E.time.events.add(1.8*Phaser.Timer.SECOND,function(){E.state.start("LevelFactory")},E)},E)),text.setText(T+"/"+P)}};return{init:function(e){E=e,O=1},getLevel:function(){return j},setLevel:function(e){O=e},getCurrentLevel:function(e){return O}}});